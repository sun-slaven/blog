---
title: SC系统架构的意义与实现
tags:
  - SC
categories:
  - 系统架构
date: 2019-02-26 23:36:59
---
本文是我在实际工作中见识到的一种系统架构，结合在前公司与现公司的一个完整的开发体验差异上，能够切身体会到它所带来的便捷性以及易用性，所以稍微研究了一番。

### 背景
很多公司都有一套完整的本地开发、测试环境，即daily、qa、pre三套环境，开发使用daily，测试使用qa以及预发。约定是这样，本身没什么问题。问题是，当公司规模变大，人员变多，环境占用问题会越来越严重，加上前端安装、打包的时间，很可能会出现为了开发或者测试一个小功能但是却要走半小时的流程，效率低下，体验感差。

有人会觉得，加机器，多部署几套环境，不就解决了么。这个是个最粗粒度的解决方案，考虑到机器的成本、运维人员的维护成本，这个解决方案只是治标不治本。

以前我的认知里不知道有什么好办法能解决这个问题。

现在SC（service chain）的方式让我眼前一亮。

### SC架构目标
1. 可以解决上面提及的环境使用排队问题
2. 提升环境稳定性，能够提供一个稳定的标准环境
3. 可以搭载全链路字段，实现对业务请求完整链路的有效监控与采样分析

### 设计思路
主要是基于两点：
##### 1.标识透传
字面意思，就是有一个标识量

表现形式是：能够在整个调用链路上进行传递，从前端传到web中间层，再到后端层层转发。

作用：通过识别该标识，可以正确的进行路由，使请求正确的发送到目标机器。
该标识可以后期扩展进行比如全链路requestId的透传，灰度发布系统的实现等工作。

##### 2.调用路由
路由上会存在一个标准路由以及 个旅游费一个sc环境路由，一般sc环境路由即一个非标准路由，通过一个标识进行标定是项目环境或者临时环境。若是某个服务未进行该sc的注册，则会默认路由到标准sc环境。
![route](https://miao.su/images/2019/02/26/sca1efc.png)

### 实现
##### 1. 发布时的系统结构

![sc](https://miao.su/images/2019/02/26/sc-7a6f1.png)

SCM上进行sc配置，然后发布系统在发布时读取scm的配置，找到对应的目标机器地址，进行代码分发。


##### 2.使用时的实现
在项目发布后，只需要在入口流量的请求头上带上全局标识。
比较好的一个方式是开发一个前端代理客户端（有赞的落地工具已开源：[ZanProxy](https://youzan.github.io/zan-proxy/)），一键选择选定的环境host以及sc标识名称。然后本地的流量代理都被劫持带上标识。

### 总结
本文概述了一下sc方案很简短的一个实现思路。
sc的解决方案能够解决环境抢占的问题，而前后端开发之间往往会存在约定不及时，联调质量差的问题。
有赞在解决前后端的接口约定与联调方面是做的比较好的。主要是基于一个很棒的平台：[ZanApi](https://segmentfault.com/a/1190000015202774)