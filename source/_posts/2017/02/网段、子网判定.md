---
title: 网段、子网判定
tags:
  -
categories:
  - 计算机网络
date: 2017-02-19 15:07:18
---
IP地址 = 网络号 + 主机号

网络号 = 本机IP与本机子网掩码进行与运算

主机号 = 本机IP与本机子网掩码的反码进行与运算

#### 如何判断两个ip在同一个网段内？

将目的主机的ip同自己的子网掩码进行与运算，得到的目标网络号与自己的网络号比对，相同则是处于同一个网段（注意并不是每台机器自己的ip和子网掩码与运算得到网络号然后进行比对），可以直接ping通（处于同一个局域网内）。同一个网段内才能ping通。同一网段的子网掩码必定相同。

比如：

PCA 的IP为 192.168.0.6 ，掩码 255.255.255.0  

PCB的IP 为192.168.1.3，掩码为 255.255.0.0



#### 为何会ping 不通？



ping操作的实际内涵是什么？看下面的步骤：
1. 由本机构造一个ICMP请求包，发送给目的主机；
2. 目的主机处理后构造一个ICMP响应包，返回给本机；
3. 本机根据是否收到响应包，以及响应包的内容得到本次ping的结果，并交由显示器呈现给用户。

也就是说，一次成功的ping操作其实是一次完整的双向通信过程，并非只要本机能将请求发送出去就算好了的。数据包要能出得去，更要回得来。


一台主机要给另一台主机发送数据时的工作流程，以A向B发送数据为例，如下图：
![](http://7xs8pt.com1.z0.glb.clouddn.com/%E5%AD%90%E7%BD%91%E5%88%A4%E5%AE%9A%E9%A1%BA%E5%BA%8F.jpg)


PCA ping PCB：
PCA首先将PCB的IP和自己的子网掩码与运算得到它所认为的PCB的网络号，192.168.1.0，发现与自身的网络号192.168.0.0不一致，判定不在同一个子网内，则交给网关，无网关则失败。

PCB ping PCA：
PCB首先将PCA的IP和自己的子网掩码与运算得到它所认为的PCA的网络号，192.168.0.0，发现与自身的网络号192.168.0.0一致，判定在同一个子网内，请求数据包成功发送给PCA.PCA处理完ICMP包后，构造完成ICMP响应包，打算回给PCB,处理过程和上面的PCA ping PCB一致，发送失败。所以也ping不通。数据包回不来。
