---
title: 网络通信过程理解
tags:
  - null
categories:
  - null
date: 2017-02-19 15:06:20
---
情形1： 使用公司的网络登录qq

| 情形 | 实质 | 举例 | 详述 | 可达性 |
|:-----:|:---|:----------|:----------|:----------:|
|1| 通过拨号的主机A访问具有公网IP的服务器B | 家里直接连接网线，并输入运营商用户名密码上网，然后登录qq。| 拨号上网本质上是主机直接获取一个外网IP(可以这么理解，其实也仅是ISP的内部IP)，然后发送数据包给另一个外网IP的主机服务器。<br>详细过程如下图1。 | 可达 |
|2| 通过路由器的局域网内的主机A访问具有公网IP的服务器B |通过公司的网络登录qq| 公司网络拓扑，入口是一个路由器，该路由器充当网关，然后内部都是交换机，主机连接交换机。当A发送数据包到交换机时，交换机通过MAC表直接转发给网关，网关进行NAT转换，即将A的内部网络IP转化为公网IP作为数据包的源IP，并进行映射（A主机的数据从a端口进入，转化为b端口的映射，下次收到b端口进来的数据就会找到A主机的内网IP），然后进行路由的转发。待qq服务器返回数据到达网关时，网关先找到A的内网ip，然后通过ARP协议找到相应的Mac地址并进行局域网内广播。交换器仅仅再次转发到A所处的子局域网。| 可达。<font color=#FF4500 size=3 face="黑体" bgcolor=#0099ff>通过NAT路由器的通信必须由局域网内的主机发起，因特网上的主机不可以向局域网内的主机发起通信，</font> 也就表面，专用网内部的主机不可以充当服务器 |
|3| 通过路由器的局域网内的主机A访问处于另一个网络的局域网中的主机B |在公司的电脑连接家里连接路由器上网的手机|因为A主机发送的数据包的dist IP为B所处的局域网的网关公网IP，所以只能到达B主机所处的局域网网关。无法到达B主机。| 一般不可达。除非进行udp穿透或者端口转发。|
![](http://7xs8pt.com1.z0.glb.clouddn.com/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B%E7%90%86%E8%A7%A3.jpeg)
<center>图1: 不同局域网下主机通信过程</center>
